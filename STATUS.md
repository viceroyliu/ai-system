# 🧠 第二大脑系统 - 项目状态

> **最后更新**：2026-02-13  
> **维护者**：Viceroy  
> **GitHub**：https://github.com/viceroyliu/ai-system

这是项目的唯一状态文档。所有架构设计、进度追踪、问题记录都以此为准。

---

## 📋 项目目标

### 三大核心目标

| # | 目标 | 描述 | 状态 |
|---|------|------|------|
| 1 | **个人成长助手** | AI 监测行为、分析复盘笔记、追踪目标、给出优化建议 | 🔄 进行中 |
| 2 | **代码助手** | 理解公司 GitLab 代码库、根据项目风格写代码、发现 bug | ⏳ 待开发 |
| 3 | **工作自动化** | 监听 Telegram 工作群、理解需求、关联代码变更、辅助完成工作 | 🔄 进行中 |

### 设计原则

- **本地优先**：数据不外泄，隐私安全
- **API 预留**：本地模型不够时可无缝切换到 Claude API
- **统一记忆**：向量数据库存储所有上下文，切换模型时记忆保留
- **模块解耦**：各功能独立，可单独启停

---

## 🖥️ 环境配置

### 硬件

| 项目 | 配置 |
|------|------|
| 设备 | Mac Mini M4 Pro |
| 内存 | 48GB |
| 存储 | 512GB |
| 网络 | 万兆网口 |
| 代理 | Surge HTTP (127.0.0.1:6152) |

### AI 模型（Ollama）

| 模型 | 用途 | 快捷指令 |
|------|------|----------|
| `qwen3:32b` | 主力模型，复杂推理 | - |
| `qwen2.5:14b-instruct` | 日常对话、快速响应 | `ai` |
| `deepseek-coder:33b-instruct-q4_K_M` | 代码生成、代码审查 | `ai-code` |

> 💡 模型会持续升级，以最新可用为准

### 服务端口

| 服务 | 端口 | 说明 |
|------|------|------|
| Open WebUI | 3000 | AI 对话界面 |
| Telegram Web | 3001 | 消息管理界面 |
| Sync API | 5100 | 同步服务接口 |
| Ollama | 11434 | 模型服务 |

---

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户交互层                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ Open WebUI  │    │ TG Web UI   │    │ 终端 CLI    │         │
│  │ :3000       │    │ :3001       │    │ ai / ai-code│         │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘         │
└─────────┼──────────────────┼──────────────────┼────────────────┘
          │                  │                  │
          ▼                  ▼                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                        AI 处理层                                 │
│  ┌───────────────────────────────────────┐  ┌─────────────┐    │
│  │            Ollama (:11434)            │  │ Claude API  │    │
│  │  qwen3:32b | qwen2.5:14b | deepseek   │  │ (预留备用)  │    │
│  └───────────────────────────────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────┐
│                        知识存储层                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ ChromaDB    │    │ SQLite      │    │ Notion      │         │
│  │ 向量索引     │    │ TG 消息     │    │ 笔记/复盘    │         │
│  │ ✅ 正常     │    │ ✅ 正常     │    │ ✅ 已连接    │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
└─────────────────────────────────────────────────────────────────┘
          ▲                  ▲                  ▲
          │                  │                  │
┌─────────────────────────────────────────────────────────────────┐
│                        数据同步层                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ ai-sync     │    │ tg-monitor  │    │ gitlab-sync │         │
│  │ :5100       │    │ 实时监听     │    │ (待开发)    │         │
│  │ ✅ 运行中   │    │ ✅ 运行中   │    │ ⏳ 规划中   │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📁 目录结构

```
~/ai-system/
├── config/                      # 配置文件 ✅ Git 跟踪
│   ├── notion.yaml             # Notion API + 数据库 ID
│   └── telegram.yaml           # Telegram 配置
│
├── data/                        # 运行时数据 ❌ 不上传 Git
│   ├── vector-db/              # 向量数据库（统一路径）
│   │   ├── blog (201条)        # 本地博客笔记
│   │   └── notion (346条)      # Notion 同步数据
│   ├── telegram.db             # Telegram 消息 SQLite
│   ├── telegram_images/        # TG 图片
│   ├── *.session               # Telegram 登录凭证
│   └── *.json                  # 状态文件
│
├── sync/                        # 同步服务 ✅ Git 跟踪
│   ├── sync_service.py         # 主同步服务
│   └── Dockerfile
│
├── telegram/                    # Telegram 模块 ✅ Git 跟踪
│   ├── tg_monitor.py           # 消息监听服务
│   ├── tg_local.py             # 本地调试版
│   ├── modules/
│   │   └── requirement_sync.py # 需求自动提取
│   └── web/
│       ├── server.py           # Web 服务
│       └── templates/
│
├── scripts/                     # 工具脚本 ✅ Git 跟踪
│   └── flomo2notion.py         # Flomo 导入
│
├── logs/                        # 日志 ❌ 不上传 Git
├── venv/                        # Python 虚拟环境 ❌ 不上传 Git
│
├── docker-compose.yml          # Docker 编排 ✅
├── start.sh                    # 启动脚本 ✅
├── stop.sh                     # 停止脚本 ✅
├── check_system.sh             # 诊断脚本 ✅
├── .gitignore                  # Git 忽略规则 ✅
└── STATUS.md                   # 本文档 ✅
```

---

## 📊 向量数据库

### Collection 说明

| Collection | 内容 | 数量 | 查询指令 |
|------------|------|------|----------|
| `blog` | 本地博客笔记 | 201 条 | `ai-blog` |
| `notion` | Notion 同步（复盘/目标/闪念/AI笔记） | 346 条 | `ai-notion` |
| **总计** | | **547 条** | `ai-list` |

### 数据来源

- **blog**: 来自 `~/Code/blogs/` 目录的 Markdown 文件
- **notion**: 来自 Notion 四个数据库的自动同步

---

## ✅ 已完成功能

### 基础架构
- [x] Docker Compose 多服务编排
- [x] Open WebUI 部署
- [x] Ollama 本地模型运行
- [x] 启动/停止/诊断脚本
- [x] 终端快捷指令 (.zshrc)
- [x] Git 仓库清理，配置 .gitignore

### Notion 集成
- [x] API 连接
- [x] 四个数据库：复盘、目标、闪念、AI笔记
- [x] 双向同步（WebUI Notes ↔ Notion）
- [x] AI 自动生成标题
- [x] Flomo 历史数据导入
- [x] 向量数据库索引

### Telegram 集成
- [x] User API 登录（通过 Surge 代理）
- [x] 实时消息监听
- [x] 消息存储到 SQLite
- [x] 图片下载保存
- [x] 需求自动提取（指定群组）
- [x] 需求状态追踪
- [x] 消息发送功能
- [x] Web 管理界面
- [x] AI 辅助回复

### 向量数据库
- [x] ChromaDB 集成
- [x] 路径统一 (`data/vector-db`)
- [x] Collection 规范命名 (`blog` / `notion`)
- [x] 搜索 API

---

## ⏳ 待开发功能

### 阶段 3：GitLab 集成

- [ ] GitLab API 连接
- [ ] 代码库索引到向量库
- [ ] 基于项目上下文的代码建议
- [ ] 代码审查辅助

### 阶段 4：智能自动化

- [ ] Telegram 需求 → 自动关联代码
- [ ] AI 分析需求 → 生成修改建议
- [ ] 代码提交 → 自动回复 Telegram

### 阶段 5：个人成长分析

- [ ] 复盘数据分析
- [ ] 目标进度可视化
- [ ] 周/月自动总结

---

## 🔧 快捷指令参考

```bash
# === 模型对话 ===
ai                  # qwen2.5:14b 对话
ai-code             # deepseek-coder 对话

# === 服务管理 ===
ai-up               # 启动所有服务
ai-down             # 停止所有服务
ai-restart          # 重启服务

# === 同步操作 ===
ai-sync             # 触发 Notion 同步
ai-status           # 查看同步状态
ai-logs             # 查看同步日志

# === 知识库 ===
ai-list             # 显示所有 collection 概览
ai-blog             # 查看本地博客（按分类统计）
ai-notion           # 查看 Notion 数据（按数据库统计）
ai-search-kb "词"   # 搜索知识库

# === 配置 ===
ai-config           # 查看配置
ai-edit             # 编辑配置
ai-check            # 运行系统诊断

# === 内存管理 ===
ai-stop-model       # 卸载模型释放内存

# === Telegram ===
tg-logs             # 查看监听日志
tg-restart          # 重启监听服务
tg-status           # 查看连接状态
```

---

## 🔗 相关链接

| 资源 | 链接 |
|------|------|
| GitHub | https://github.com/viceroyliu/ai-system |
| Notion 工作区 | https://www.notion.so/AI-2edfd8a80a7980bba9b0f9b719950ab6 |
| AI 搭建指令 | https://www.notion.so/AI-2eefd8a80a7980b1bff0e307c4cda453 |

---

## 📅 更新日志

### 2026-02-13
- 向量数据库 Collection 重命名：`blog` + `notion`
- 修复 Notion 同步 401 错误（Token 更新）
- 优化快捷指令：ai-list / ai-blog / ai-notion 统一显示格式
- 清理旧的重复 collection

### 2026-02-12
- Git 仓库大清理
  - 移除 venv/ (297MB)
  - 移除 cache/chroma/ (167MB)
  - 移除 data/ (敏感数据)
  - 配置 .gitignore
- 向量数据库路径统一为 `data/vector-db`
- 修复 sync_service.py 数据库路径

### 2026-02-01
- Telegram 监听服务完善
- 需求自动提取功能
- Web 管理界面上线

### 2026-01 早期
- 项目初始化
- Open WebUI + Ollama 部署
- Notion 同步基础功能

---

## 💡 下次对话提示

在新的 AI 对话中继续这个项目时：

1. 将此 STATUS.md 上传到项目知识库
2. 说明你要处理的具体任务
3. 如有报错，附上相关日志

**示例开场白：**
> 我在继续"第二大脑"项目。STATUS.md 已在项目知识库中。  
> 我现在需要 [添加 GitLab 集成 / 优化 Telegram 自动化 / ...]
